---
layout: post
status: publish
published: true
title: Build an SMS to email gateway in under ten minutes
author:
  display_name: henare
  login: henare
  email: henare.degan@gmail.com
  url: http://www.henaredegan.com/
author_login: henare
author_url: http://www.henaredegan.com/
wordpress_id: 329
wordpress_url: http://www.henaredegan.com/blog/?p=329
date: '2010-09-06 09:42:14 +1000'
date_gmt: '2010-09-05 23:42:14 +1000'
categories:
- Geekery
tags:
- sms
- gammu
- mutt
- sms to email
comments: []
---
<p>If you use an SMS gateway, such as <a href="http://www.clickatell.com/">Clickatell</a>, to send SMS from your website or computer, you might want to set up your own simple return path for people to reply to those SMS and have them emailed to you.</p>
<p>With an always-on <strong>Ubuntu 10.04 machine</strong>, an <strong>old mobile</strong> phone and a cheap <strong>pre-paid SIM</strong>, you can have this setup in under 10 minutes.</p>
<p>First, install the required software; the <a href="http://wammu.eu/smsd/">Gammu SMS daemon</a> for getting the SMS off the mobile and <a href="http://www.mutt.org/">Mutt</a> for sending our emails.</p>
<p><code lang="bash"><br />
$ sudo apt-get install gammu-smsd mutt<br />
</code></p>
<p>Put this little shell script somewhere like [cci]/var/spool/gammu/mail_wrapper.sh[/cci], customising the email addresses. It will be used to send the email when an SMS is received:</p>
<p><code lang="bash"><br />
#!/bin/bash<br />
export EMAIL="SMS Daemon <sms@example.com>"<br />
echo | mutt you@example.com -i "/var/spool/gammu/inbox/$1" -a "/var/spool/gammu/inbox/$1" -s "SMS Received"<br />
</code></p>
<p>Attach your phone to your computer (mine was USB) and select "Phone mode" or similar on the mobile (as opposed to mass storage mode or photo mode, for example). Follow your system log to see what port your mobile shows up on, you should see output similar to this:</p>
<p><code lang="bash"><br />
$ tail -f /var/log/syslog<br />
Sep  6 09:00:22 smsgateway kernel: [105224.650743] usb 1-4: new high speed USB device using ehci_hcd and address 6<br />
Sep  6 09:00:22 smsgateway kernel: [105224.991701] usb 1-4: configuration #3 chosen from 1 choice<br />
Sep  6 09:00:22 smsgateway kernel: [105224.995894] cdc_acm 1-4:3.1: ttyACM0: USB ACM device<br />
Sep  6 09:00:22 smsgateway kernel: [105224.997427] cdc_acm 1-4:3.3: ttyACM1: USB ACM device<br />
Sep  6 09:00:22 smsgateway kernel: [105225.000013] cdc_wdm 1-4:3.7: cdc-wdm0: USB WDM device<br />
</code></p>
<p>The logs above show my mobile exposing two USB modem ports, [cci]/dev/ttyACM0[/cci] and [cci]/dev/ttyACM1[/cci]. Trial and error lead me to discover that [cci]/dev/ttyACM1[/cci] was the port I was looking for.</p>
<p>Now configure this port in your [cci]/etc/gammu-smsdrc[/cci] file with the line [cci]port = /dev/ttyACM1[/cci] and add the line [cci]runonreceive = /var/spool/gammu/mail_wrapper.sh[/cci] so that the script we created earlier is executed when an SMS is received. The complete [cci]/etc/gammu-smsdrc[/cci] file should look similar to this:</p>
<p><code lang="bash"><br />
# Configuration file for Gammu SMS Daemon</p>
<p># Gammu library configuration, see gammurc(5)<br />
[gammu]<br />
# Please configure this!<br />
port = /dev/ttyACM1<br />
connection = at<br />
# Debugging<br />
#logformat = textall</p>
<p># SMSD configuration, see gammu-smsdrc(5)<br />
[smsd]<br />
service = files<br />
logfile = syslog<br />
# Increase for debugging information<br />
debuglevel = 0</p>
<p># Paths where messages are stored<br />
inboxpath = /var/spool/gammu/inbox/<br />
outboxpath = /var/spool/gammu/outbox/<br />
sentsmspath = /var/spool/gammu/sent/<br />
errorsmspath = /var/spool/gammu/error/</p>
<p>runonreceive = /var/spool/gammu/mail_wrapper.sh<br />
</code></p>
<p>Now start Gammu's smsd and, with the configuration above, Gammu will log activity to syslog so you can send an SMS and see the fruits of your labour:</p>
<p><code lang="bash"><br />
$ sudo service gammu-smsd start<br />
 * Starting Gammu SMS Daemon gammu-smsd                                                                                                                                   [ OK ]<br />
$ tail -f /var/log/syslog<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: Configuring Gammu SMSD...<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: SHM token: 0xffffffff<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: Warning: No PIN code in /etc/gammu-smsdrc file<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: commtimeout=30, sendtimeout=30, receivefrequency=0, resetfrequency=0<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: checks: security=1, battery=1, signal=1<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: deliveryreport = no<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: phoneid =<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: Inbox is "/var/spool/gammu/inbox/" with format "standard"<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: Outbox is "/var/spool/gammu/outbox/" with transmission format "7bit"<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: Sent SMS moved to "/var/spool/gammu/sent/"<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11229]: SMS with errors moved to "/var/spool/gammu/error/"<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11232]: Using FILES service<br />
Sep  6 09:09:00 smsgateway gammu-smsd[11232]: Starting phone communication...<br />
Sep  6 09:09:13 smsgateway gammu-smsd[11232]: Received message from +61412345678<br />
Sep  6 09:09:13 smsgateway gammu-smsd[11232]: Received IN20100902_165719_00_+61412345678_00.txt<br />
Sep  6 09:09:13 smsgateway gammu-smsd[11258]: Starting run on receive: "/var/spool/gammu/mail_wrapper.sh" IN20100902_165719_00_+61412345678_00.txt<br />
Sep  6 09:09:13 smsgateway gammu-smsd[11232]: Process finished successfully<br />
</code></p>
<p>If you run into any problems or need some help, please leave a comment below.</p>
<p><em>Note that there are more sophisticated ways of setting this up and many gateway providers have a much easier method to achieve the same result without you having to set up anything.</em></p>
